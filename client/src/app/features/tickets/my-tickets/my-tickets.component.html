<div class="container">
  <h2>Order History & My Tickets</h2>
  
  <div class="table-wrapper">
    <table>
      <thead>
        <tr>
          <th>Artist</th>
          <th>Event</th>
          <th>Venue</th>
          <th>Event Date</th>
          <th>Purchase Date</th>
          <th>Price</th>
          <th>Status</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        @for (ticket of tickets; track ticket._id) {
          <tr>
            <td>
              <div class="artist-name" style="font-weight: 600; color: var(--primary-text-color);">
                {{ ticket.event.performance.artistProfile.artistName }}
              </div>
            </td>
            <td>
              <div class="event-name">{{ ticket.event.performance.performanceName }}</div>
            </td>
            <td>
              {{ ticket.event.venue.name }}<br>
              <small>{{ ticket.event.venue.city }}, {{ ticket.event.venue.state }}</small>
            </td>
            <td>
              {{ ticket.event.startDateTime | date:'mediumDate' }}<br>
              <small>{{ ticket.event.startDateTime | date:'shortTime' }}</small>
            </td>
            <td>{{ ticket.purchaseDate | date:'shortDate' }}</td>
            <td>{{ ticket.price | currency }}</td>
            <td>
              <span class="status" [ngClass]="ticket.status">{{ ticket.status }}</span>
            </td>
            <td>
              <button (click)="openTicketModal(ticket)" class="btn btn-view">View Voucher</button>
            </td>
          </tr>
        } @empty {
          @if (!loading) {
            <tr>
              <td colspan="8" class="empty-state">You haven't purchased any tickets yet.</td>
            </tr>
          }
        }
      </tbody>
    </table>
  </div>

  @if (loading) {
    <div class="loading-state">Loading tickets...</div>
  }

  @if (hasMore && !loading) {
    <div class="load-more-container">
      <button (click)="loadMore()" class="btn btn-secondary">Load More Tickets</button>
    </div>
  }

  <!-- QR Code Modal -->
  @if (selectedTicket) {
    <div class="modal-overlay" (click)="closeModal()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h3>Ticket Voucher</h3>
          <button class="close-btn" (click)="closeModal()">&times;</button>
        </div>
        <div class="modal-body">
          <div class="qr-container">
            @if (qrCodeUrl) {
              <img [src]="qrCodeUrl" alt="Ticket QR Code">
            } @else {
              <p>Generating Code...</p>
            }
          </div>
          <div class="ticket-details">
            <h4>{{ selectedTicket.event.performance.performanceName }}</h4>
            <p><strong>Code:</strong> {{ selectedTicket._id }}</p>
            <p class="info-text">Present this QR code at the venue entrance.</p>
          </div>
        </div>
      </div>
    </div>
  }
</div>

<style>
  .load-more-container {
    text-align: center;
    padding: 1.5rem;
    margin-top: 1rem;
  }
  
  .loading-state {
    text-align: center;
    padding: 1.5rem;
    color: var(--secondary-text-color);
  }

  .btn-secondary {
    background-color: #374151;
    color: white;
    padding: 0.6rem 1.2rem;
    border: none;
    border-radius: 4px;
    cursor: pointer;
  }
  .btn-secondary:hover {
    background-color: #4b5563;
  }
</style>